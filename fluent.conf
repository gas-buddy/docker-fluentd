<source>
  @type syslog
  port 5140
  bind 0.0.0.0
  tag haproxy.http
  format /^(?<syslog_time>.+) (?<ps>\w+)\[(?<pid>\d+)\]: (?<c_ip>[\w\.]+):(?<c_port>\d+) \[(?<time>.+)\] (?<f_end>[\w\.-]+) (?<b_end>[\w\.-]+)\/(?<b_server>[\w\.-]+) (?<tq>\d+)\/(?<tw>\d+)\/(?<tc>-?\d+)\/(?<tr>-?\d+)\/(?<tt>\d+) (?<status_code>-?\d+) (?<bytes>\d+) (?<req_cookie>\S+) (?<res_cookie>\S+) (?<t_state>[\w-]+) (?<actconn>\d+)\/(?<feconn>\d+)\/(?<beconn>\d+)\/(?<srv_conn>\d+)\/(?<retries>\d+) (?<srv_queue>\d+)\/(?<backend_queue>\d+) "(?<request>[^"]*)"$/
  time_format %d/%B/%Y:%H:%M:%S
</source>

<match **>
  @type copy
  <store>
    @type stdout
  </store>
  <store>
    @type elasticsearch
    host "#{ENV["ELASTICSEARCH_HOST"]}"
    user "#{ENV["ELASTICSEARCH_USERNAME"]}"
    password "#{ENV["ELASTICSEARCH_PASSWORD"]}"
    logstash_format true
    logstash_prefix "#{ENV["ELASTICSEARCH_PREFIX"]}"
    time_key timestamp
    reconnect_on_error true
    flush_interval 5
    port 9200
  </store>
</match>
